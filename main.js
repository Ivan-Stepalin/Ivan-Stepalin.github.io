(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=function(e){return e.ok?e.json():Promise.reject("Сервер не доступен")},n=function(){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this._url=e.url,this._headers=e.headers}var o,r;return o=n,(r=[{key:"getUserInfo",value:function(e){return fetch("".concat(this._url,"users/me"),{method:"GET",headers:this._headers}).then(t).then((function(t){e(t)}))}},{key:"sendUserInfo",value:function(e,n,o){return o(!0),fetch("".concat(this._url,"users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(t).then((function(e){n(e)})).finally((function(){o(!1)}))}},{key:"initialCard",value:function(e){return fetch("".concat(this._url,"cards"),{headers:this._headers}).then(t).then((function(t){e(t)}))}},{key:"addCard",value:function(e,n,o){return o(!0),fetch("".concat(this._url,"cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(t).then((function(e){n(e)})).finally((function(){o(!1)}))}},{key:"deleteCard",value:function(e,n){return fetch("".concat(this._url,"cards/").concat(e),{method:"DELETE",headers:this._headers}).then(t).then((function(e){n(e)}))}},{key:"likeCard",value:function(e,n){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then(t).then((function(e){return n(e),e}))}},{key:"disLikeCard",value:function(e,n){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then(t).then((function(e){n(e)}))}},{key:"updateAvatar",value:function(e,n,o){return o(!0),fetch("".concat(this._url,"users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(t).then((function(e){n(e)})).finally((function(){o(!1)}))}}])&&e(o.prototype,r),n}();function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(){function e(t){var n,o,r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=function(e){"Escape"===e.key&&r.close()},(n="_handleEscClose")in this?Object.defineProperty(this,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[n]=o,this.popup=document.querySelector(t),this._popupOpened="popup_opened",this._popupCloseIcon="popup__close-icon"}var t,n;return t=e,(n=[{key:"open",value:function(){this.popup.classList.add(this._popupOpened),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this.popup.classList.remove(this._popupOpened),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var e=this;this.popup.addEventListener("click",(function(t){(t.target.classList.contains(e._popupCloseIcon)||t.target.classList.contains(e._popupOpened))&&e.close()}))}}])&&o(t.prototype,n),e}();function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(p,e);var t,n,o,r,i=(o=p,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(o);if(r){var n=f(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return u(this,e)});function p(e,t){var n,o,r,a,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),c=function(e,t){s((n=l(o),f(p.prototype)),"open",n).call(n),o._element=e,o._data=t},(a="open")in(r=l(o=i.call(this,e)))?Object.defineProperty(r,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):r.open=c,o._handlerDeleteCard=t,o}return t=p,(n=[{key:"setEventListeners",value:function(){var e=this;s(f(p.prototype),"setEventListeners",this).call(this),this.popup.addEventListener("submit",(function(t){t.preventDefault(),e._handlerDeleteCard(e._element,e._data)}))}}])&&a(t.prototype,n),p}(r),h={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__submit-button",inputInvalidClass:"popup__field_state_invalid",buttonInvalidClass:"popup__submit-button_state_invalid",spanSelector:".popup__error"};function d(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var y=function(){function e(t,n,o,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._handleCardClick=r,this._name=n.name,this._link=n.link,this._templateElement=o,this._like=n.likes.length,this._cardOwnerId=n.owner._id,this._handleDeleteCardClick=i,this._handleLikeCard=a,this._owner=t,this._data=n}var t,n;return t=e,(n=[{key:"composeCard",value:function(){this._newCard=document.querySelector(this._templateElement).content.cloneNode(!0);var e=this._newCard.querySelector(".element__image");e.addEventListener("click",this._handleCardClick),this._newCard.querySelector(".element__name").textContent=this._name,e.src=this._link,e.alt=this._name,this._newCard.querySelector(".element__group-count").textContent=this._like;var t=this._newCard.querySelector(".element__bracket");return t.addEventListener("click",this._handleDeleteCardClick),this._cardOwnerId!==this._owner._id&&t.classList.add("element__bracket_disabled"),this._likeButton=this._newCard.querySelector(".element__group"),this._likeButton.addEventListener("click",this._handleLikeCard),this.isLike(this._data)&&this._likeButton.classList.toggle("element__group_active"),this._newCard}},{key:"isLike",value:function(e){var t=this;return e.likes.some((function(e){return e._id===t._owner._id}))}},{key:"likeCard",value:function(e){this._likeButton.parentElement.querySelector(".element__group-count").textContent=e.likes.length,this._likeButton.classList.toggle("element__group_active")}}])&&d(t.prototype,n),e}();function _(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var v=function(){function e(t,n){var o,r,i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(){i._setEventListeners(),i.setButtonState(i._submitButton,i.elementForValidation.querySelector(i.objectWithClass.formSelector).checkValidity())},(o="enableValidation")in this?Object.defineProperty(this,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[o]=r,this.elementForValidation=n,this.objectWithClass=t,this._inputList=this.elementForValidation.querySelectorAll(this.objectWithClass.inputSelector),this._submitButton=this.elementForValidation.querySelector(this.objectWithClass.submitButtonSelector)}var t,n;return t=e,(n=[{key:"_showError",value:function(e){this.elementForValidation.querySelector("#".concat(e.id,"-error")).textContent=e.validationMessage,e.classList.add(this.objectWithClass.inputInvalidClass)}},{key:"_hideError",value:function(e){this.elementForValidation.querySelector("#".concat(e.id,"-error")).textContent="",e.classList.remove(this.objectWithClass.inputInvalidClass)}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideError(e):this._showError(e)}},{key:"setButtonState",value:function(e,t){t?(e.classList.remove(this.objectWithClass.buttonInvalidClass),e.disabled=!1):(e.classList.add(this.objectWithClass.buttonInvalidClass),e.disabled=!0)}},{key:"deleteErrors",value:function(){var e=this;this.elementForValidation.querySelectorAll(this.objectWithClass.inputSelector).forEach((function(t){t.classList.remove(e.objectWithClass.inputInvalidClass)})),this.elementForValidation.querySelectorAll(this.objectWithClass.spanSelector).forEach((function(e){e.textContent=""}))}},{key:"_setEventListeners",value:function(){var e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e.setButtonState(e._submitButton,e.elementForValidation.querySelector(e.objectWithClass.formSelector).checkValidity())}))}))}}])&&_(t.prototype,n),e}();function m(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var b=function(){function e(t,n){var o=t.items,r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._rendererItems=o,this._renderer=r,this._container=n}var t,n;return t=e,(n=[{key:"addItem",value:function(e){this._container.prepend(e)}},{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){t._renderer(e)}))}}])&&m(t.prototype,n),e}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function C(e,t,n){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=E(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(a,e);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=E(o);if(r){var n=E(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return w(this,e)});function a(e,t,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(o=i.call(this,e))._image=o.popup.querySelector(t),o._imageName=o.popup.querySelector(n),o}return t=a,(n=[{key:"open",value:function(e,t){this._imageName.textContent=e,this._image.src=t,this._image.alt=e,C(E(a.prototype),"open",this).call(this)}}])&&g(t.prototype,n),a}(r);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function q(e,t,n){return(q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(a,e);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(o);if(r){var n=R(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return I(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e))._formSubmit=t,n._form=n.popup.querySelector(".popup__form"),n._inputList=n._form.querySelectorAll(".popup__field"),n}return t=a,(n=[{key:"_getInputValues",value:function(){var e={};return this._inputList.forEach((function(t){e[t.name]=t.value})),e}},{key:"setEventListeners",value:function(){var e=this;q(R(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e._formSubmit(e._getInputValues())}))}},{key:"close",value:function(){q(R(a.prototype),"close",this).call(this),this._form.reset()}}])&&L(t.prototype,n),a}(r);function V(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var T,B=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._elementName=document.querySelector(t),this._elementInfo=document.querySelector(n),this._avatarElement=document.querySelector(o)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){var e={};return e.name=this._elementName.textContent,e.about=this._elementInfo.textContent,e}},{key:"setUserInfo",value:function(e){this._elementName.textContent=e.name,this._elementInfo.textContent=e.about}},{key:"setAvatar",value:function(e){this._avatarElement.src=e.avatar}}])&&V(t.prototype,n),e}(),D=document.querySelector(".popup_title"),A=D.querySelector(".popup__form_title"),W=A.querySelector(".popup__field_value_name"),U=A.querySelector(".popup__field_value_job"),F=D.querySelector(".popup__submit-button"),N=document.querySelector(".popup_element"),J=N.querySelector(".popup__form_element"),H=N.querySelector(".popup__submit-button"),z=document.querySelector(".profile__edit-button"),G=document.querySelector(".profile__add-button"),M=document.querySelector(".elements"),K=document.querySelector(".profile__avatar-button"),Q=document.querySelector(".popup_avatar-update"),X=Q.querySelector(".popup__form_avatar-update"),Y=Q.querySelector(".popup__submit-button"),Z=new n({url:"https://mesto.nomoreparties.co/v1/cohort-20/",headers:{Authorization:"d51ae317-8999-42e3-a61f-4d1c740f977c","Content-Type":"application/json"}}),$=new B(".profile__title",".profile__subtitle",".profile__avatar");function ee(e){var t=new y(T,e,"template",(function(){return oe.open(e.name,e.link)}),(function(t){return te.open(t.target.parentElement,e)}),(function(){t.isLike(e)?Z.disLikeCard(e._id,(function(n){e=n,t.likeCard(e)})).catch((function(e){console.log("ошибка ".concat(e))})):Z.likeCard(e._id,(function(n){e=n,t.likeCard(e)})).catch((function(e){console.log("ошибка ".concat(e))}))})),n=t.composeCard();ne.addItem(n)}Z.getUserInfo((function(e){$.setUserInfo(e),$.setAvatar(e),T=e})).catch((function(e){console.log("ошибка ".concat(e))}));var te=new p(".popup_confim",(function(e,t){Z.deleteCard(t._id,(function(){e.remove(),e=null})).catch((function(e){console.log("ошибка ".concat(e))})),te.close()}));te.setEventListeners();var ne=new b({renderer:function(e){ee(e)}},M);Z.initialCard((function(e){ne.renderItems(e)})).catch((function(e){console.log("ошибка ".concat(e))}));var oe=new O(".popup_image",".popup__image",".popup__image-name");oe.setEventListeners();var re=new v(h,D);re.enableValidation();var ie=new v(h,N);ie.enableValidation();var ae=new v(h,Q);ae.enableValidation();var ce=new x(".popup_element",(function(e){Z.addCard(e,(function(e){ee(e)}),(function(e){e?H.textContent="Сохранение...":(H.textContent="Сохранить",ce.close())})).catch((function(e){console.log("ошибка ".concat(e))}))}));ce.setEventListeners(),z.addEventListener("click",(function(){var e=$.getUserInfo();W.value=e.name,U.value=e.about,re.deleteErrors(),re.setButtonState(D.querySelector(h.submitButtonSelector),A.checkValidity()),ue.open()})),G.addEventListener("click",(function(){ie.deleteErrors(),ie.setButtonState(N.querySelector(h.submitButtonSelector),J.checkValidity()),ce.open()}));var ue=new x(".popup_title",(function(e){Z.sendUserInfo(e,(function(e){$.setUserInfo(e)}),(function(e){e?F.textContent="Сохранение...":(F.textContent="Сохранить",ue.close())})).catch((function(e){console.log("ошибка ".concat(e))}))}));ue.setEventListeners();var le=new x(".popup_avatar-update",(function(e){Z.updateAvatar(e.avatar,(function(e){$.setAvatar(e),le.close()}),(function(e){e?Y.textContent="Сохранение...":(Y.textContent="Сохранить",le.close())})).catch((function(e){console.log("ошибка ".concat(e))}))}));le.setEventListeners(),K.addEventListener("click",(function(){le.open(),ae.deleteErrors(),ae.setButtonState(Q.querySelector(h.submitButtonSelector),X.checkValidity())}))})();